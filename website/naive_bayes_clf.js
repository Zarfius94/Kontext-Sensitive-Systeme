var GaussianNB = function(priors, sigmas, thetas) {

    this.priors = priors;
    this.sigmas = sigmas;
    this.thetas = thetas;

    this.predict = function(features) {
        var likelihoods = new Array(this.sigmas.length);
    
        for (var i = 0, il = this.sigmas.length; i < il; i++) {
            var sum = 0.;
            for (var j = 0, jl = this.sigmas[0].length; j < jl; j++) {
                sum += Math.log(2. * Math.PI * this.sigmas[i][j]);
            }
            var nij = -0.5 * sum;
            sum = 0.;
            for (var j = 0, jl = this.sigmas[0].length; j < jl; j++) {
                sum += Math.pow(features[j] - this.thetas[i][j], 2.) / this.sigmas[i][j];
            }
            nij -= 0.5 * sum;
            likelihoods[i] = Math.log(this.priors[i]) + nij;
        }
    
        var classIdx = 0;
        for (var i = 0, l = likelihoods.length; i < l; i++) {
            classIdx = likelihoods[i] > likelihoods[classIdx] ? i : classIdx;
        }
        return classIdx;
    };

};

function predictGNB(features) {

    log.addToLog("Doing prediction");
    log.addToLog(features);

    // Parameters:
    var priors = [0.508461235733963, 0.18378591105863834, 0.30775285320739865];
    var sigmas = [[621.8345274764021, 573.5818339446615, 26.355715235115333, 16.88706321264151, 110.91816337562385, 347511.4723260608, 1156.310696731119, 778.3555677230664, 36.74476486575582, 32.04205083797541, 156.2192334436535, 814069.5529608022, 584.4038358232064, 613.8162831187844, 47.59365862626288, 22.14362183464189, 121.11600902735316, 1031388.0148854587, 1.714388033592945, 2.150683885108125, 1.0413136173600868, 1.060753161028843, 0.1949388509882318, 1.5321211418710379, 13.260492435916118, 13.513362880272092, 12.721968437979415, 12.737144749809504, 0.15003170680369812, 0.8262870827804046, 9.35946292852575, 8.291574971069462, 6.900791462761315, 6.876230739497339, 0.2648550284950932, 2.1234806631094703], [3640.573952408704, 1836.862702910272, 176.64923964186698, 110.80965209210257, 543.1166237724035, 7114572.443848858, 3117.9880847121353, 4209.3050448231415, 301.431064628323, 202.97991250308806, 709.9266045698687, 13104556.91545338, 2547.9468574168836, 2761.8538901376787, 405.0217015631165, 293.10988823732663, 570.6717263330485, 8701301.961544523, 5.613602011503783, 8.490688335804789, 3.007058739842559, 2.835887502906015, 0.9601153072847365, 23.558996591974523, 32.88563741418911, 27.40754174845267, 27.36304523950689, 27.78811006829314, 0.9337372135477172, 29.365280551917188, 34.90104235918696, 32.03863665548522, 27.333683197865643, 27.46041563296678, 1.1487842879369674, 37.60935838246225], [3820.580267434247, 3443.0952387769025, 579.2477541288605, 563.2695494704601, 753.5042006128168, 14642194.706856264, 4943.358569021024, 5618.81274192774, 1083.438789811722, 972.2429985742729, 951.9187055344428, 22995682.24534871, 3594.220196450482, 5205.033258893119, 820.6823053141189, 839.5421569524657, 1204.5854646884825, 32097262.869857315, 17.709703184641054, 26.831950177643257, 14.378781175900553, 14.94411081757581, 1.9087531511483546, 132.11006840377013, 48.829023905990574, 40.596439901820006, 35.08485027034277, 34.913502200510635, 1.7325502250098503, 117.08233104989918, 31.189907705787626, 32.34455227083495, 24.22651679831121, 23.93484847534272, 1.1954339909095444, 54.72543165293168]];
    var thetas = [[-9.090107527041434, 8.74169719025555, -0.0732178938928784, -0.15751374947742058, 4.137162511494346, 128.02118783763248, -10.947611477691629, 9.952995084729176, -0.17079478706376452, -0.13230934454739954, 4.5430969730568975, 176.84587436574685, -6.939049901647009, 7.628979602398819, 0.2897481792422828, 0.16299062483685955, 3.544384829271386, 133.6655836608168, -0.36579660302714223, 0.4359208716319382, 0.0352376161750292, 0.029843769206718954, 0.1873178122297042, 0.2169376292611923, 1.8626899882804684, 2.4612365624421324, 2.1708228734234973, 2.1727452240186045, 0.14720536778294233, 0.15861194260224787, 7.915493694725534, 9.015496970439807, 8.444377690981266, 8.441458862000905, 0.22605494272027776, 0.3028666811177998], [-33.479139894367634, 26.09914657904747, -1.4967654770222396, -0.4208546057270091, 14.69688919221764, 759.1020865162211, -31.710061137948763, 34.3236558730106, 0.2584153217789744, -0.1802657105994502, 15.879581653841969, 962.0746288863969, -22.048200327395875, 25.51893673954419, 0.9649535261827785, 0.42106053093031653, 12.566908857274075, 728.5858353755763, -0.5722618399473488, 1.8202680527678894, 0.568801108592872, 0.528870524647146, 0.5979457225900929, 1.3045652099429634, -0.4396426239002436, 1.4738248315983937, 0.5394706600799531, 0.5357474506192167, 0.4947087565579624, 1.1653847828572823, 4.498565560642637, 7.5674683702832795, 6.041390122026382, 6.043603838725936, 0.6988719583942418, 1.624117117661211], [-67.53715269730948, 68.60005955659706, 0.8925233788370687, 1.356958794295005, 34.479851933505806, 1942.3513007848003, -75.39790826946934, 68.93240042113723, -3.9748605174109164, -4.490396963388387, 36.73649460704035, 2301.4756523630394, -58.76308732572284, 68.81776487327929, 2.6864982957555728, 2.324428998500594, 36.00368788995817, 2500.8379171814986, -0.6413164599962511, 5.228886251548832, 2.224068599024459, 2.183207095109452, 1.4724233159404276, 4.063694387967806, -4.733072537157997, 0.5714447829125778, -1.7951855285853033, -1.7291822408905027, 1.3286685931483344, 3.484821270923056, 0.5592115090999764, 7.264775951711376, 3.8657363894219503, 3.8592918212933505, 1.582237149062681, 3.685819202277986]];

    // Estimator:
    var clf = new GaussianNB(priors, sigmas, thetas);
    var prediction = clf.predict(features);

    
    console.log(prediction);
    
    return prediction;

}

var NBclasses = {
        0: "sitting",
        1: "standing",
        2: "walking"
    }